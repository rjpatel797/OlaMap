
<script type="text/javascript">
var url="Jsoncontroller?";
var query="Operation=getMaintainanceAlertType";
//alert(url+query);
$.ajax({
    type: "GET",
    url: API+url+query,
    dataType: "jsonp",
    success: function(msg2) 
    {
 //   alert(msg2);
    	 var conten="";
      	var msg = eval(msg2);

    	var select= '<select  name="MaintainanceExpiryType" id="MaintainanceExpiryTypeid" >';
        for(var i=0;i<msg.length;i++)
        {
        	conten = conten+' <option value="'+msg[i] [0]+'">'+msg[i][1]+'</option>';
        }
        $("#MaintainanceExpiryType").html(select+conten+"</select>");
     
    }
});







</script>
    
      
             <div class="modal-header">
 <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	  <h4> Update Maintainance Information</h4>
</div>
<div class="modal-body">
        <div id="welcometext" ></div>
        <div id="welcometext1"   ></div>
       <input type="hidden" id="mmid" name="mmid" />
       <input type="hidden" id="MaintainanceDeviceName" name="MaintainanceDeviceName"/>
                <div class="control-group">
                    <label class="control-label" for="inputMaintainanceDeviceName"> Device Name</label>
                  <div id="devicename"></div>
                </div>   
                <div class="control-group">

                    <label class="control-label" for="inputMaintainanceExpiryType">Expiry Type</label>
                    <div class="controls">
                      <div id="MaintainanceExpiryType"></div> 
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="inputMaintainanceStartDate">Date rage:</label>
                <div class="input-group">
                  <div class="input-group-addon">
                    <i class="fa fa-clock-o"></i>
                  </div>
                  <input type="text" class="form-control pull-right " id="reservationtime">
                </div>
                </div>
               <!--  <div class="control-group">
                    <label class="control-label" for="inputMaintainanceStartDate">Start Date</label>
                    <div class="controls">
                        <input type="text" name="MaintainanceStartDate" id="MaintainanceStartDate" placeholder="Maintainance Start Date"/>

                    </div>
                </div>    

                
                <div class="control-group">
                    <label class="control-label" for="inputMaintainanceDueDate">Due Date</label>
                    <div class="controls">
                        <label id="MaintainanceDueDate" name="MaintainanceDueDate"></label>
              <input type="text" name="MaintainanceDueDate" id="MaintainanceDueDate" placeholder="Maintainance End Date"/>
                    </div>
                </div> -->
                <div class="control-group">
                    <label class="control-label" for="inputMaintainanceAlertBefore" > Alert Before</label>
                    <div class="controls">
                        <input type="text" name="MaintainanceAlertBefore" id="MaintainanceAlertBefore" placeholder="Maintainance Alert Before" value="7"/>

                    </div>
                </div> 
                <input type="hidden" id="MaintainanceAlertType" value="Both">
                <div class="control-group">
                    <label class="control-label" for="inputMaintainanceAlertNo" id="lblMaintainanceAlertNo"> Alert No</label>
                    <div class="controls">
                        <input type="text" name="MaintainanceAlertNo" id="MaintainanceAlertNo" placeholder="Maintainance Alert No"/>

                    </div>
                </div>              
                <div class="control-group">
                    <label class="control-label" for="inputMaintainanceEmailID" id="lblMaintainanceEmailID"> Email ID</label>
                    <div class="controls">
                        <input type="text" name="MaintainanceEmailID" id="MaintainanceEmailID" placeholder="Maintainance Email ID"/>

                    </div>
                </div>                         

           <div class="control-group">
                    <label class="control-label" for="inputMaintainancePeriod">Period</label>
                    <div class="controls">

                        <input type="text"  class="input-mini"  id="MaintainancePeriod" name="MaintainancePeriod"  /> Days

 
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="inputNotes">Notes</label>
                    <div class="controls">
                        <textarea type="text" name="Notes" id="Notes" placeholder="Notes"></textarea>
                    </div>
                    
                </div>
                <input type="hidden" id="IsActive" value="1"/>
              <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="insert()" >Save</button>
      </div>     
            

</div>


  <script type="text/javascript">
           $(document).ready(function(){
        	   $('#reservationtime').daterangepicker({timePicker: true, timePickerIncrement: 30, format: 'DD/MM/YYYY HH:mm:ss',timePicker12Hour: false});
           });
 
            function insert()
            {
                // MaintainanceStartDate
                // alert($("#MaintainanceDueDate").text());
                var reservationtime=$("#reservationtime").val().split("-");
                var post_data='MaintainanceDeviceName='+$("#MaintainanceDeviceName").val()+'&MaintainanceExpiryType='+$("#MaintainanceExpiryTypeid").val()+'&isActive='+$("#IsActive").val()+'&MaintainancePeriod='+$( "#MaintainancePeriod" ).val()+'&MaintainanceDueDate='+reservationtime[1]
                    +'&MaintainanceAlertBefore='+$("#MaintainanceAlertBefore").val() +'&MaintainanceStartDate='+reservationtime[0]+'&MaintainanceAlertType='+$("#MaintainanceAlertType").val()+'&MaintainanceAlertNo='+$("#MaintainanceAlertNo").val()+'&MaintainanceEmailID='+$("#MaintainanceEmailID").val()+"&Notes="+$("#Notes").val()+"&option=Update"+"&mmid="+$("#mmid").val();
                
                console.log(post_data);
                $.ajax({
                    type: "GET",
                    url: API+"Jsoncontroller?Operation=maintainacealertinfo",                        
                    data: post_data,
                    dataType: "jsonp",
                    beforeSend: function(HttpRequest){
                        $("#welcometext").html("<em class='loding'>&nbsp;Please wait while saving....</em>");
                    },
                    success: function(response) {  
                        //  alert(response);			
                        if(response==1)
                        {
                            $("#welcometext").html("<em color='green'  class='alert alert-success'>&nbsp;Suceessfully Updated!!!!!!</em>");
                        //    clear_form_elements(ele);
                        }
                        else 
                        {               
                            $("#welcometext1").html("<em color='red' class='alert alert-error'>&nbsp;Record Already Exist</em>");
                        }
                    }                             
                             
                    //$("#status").fadeOut(10000);
                });
                getMaintainancemaster(null);       
            }               
           

                



        </script>
        <script type="text/javascript">
 
                  
                $('#MaintainanceAlertType').change(function() {
                    var optval= $( "select#MaintainanceAlertType" ).val();
                    if(optval=="Mail")
                    {
                         
                        $( "#MaintainanceAlertNo" ).attr("disabled","disabled");
                        $( "#MaintainanceEmailID" ).removeAttr("disabled");
                                            
                         
                    }
                    else if(optval=="SMS")
                    {
                       
                        $( "#MaintainanceEmailID" ).attr("disabled","disabled");
                        $( "#MaintainanceAlertNo" ).removeAttr("disabled");
                        
                    }
                    else if(optval=="None")
                    {
                        $( "#MaintainanceAlertNo" ).attr("disabled","disabled");
                        $( "#MaintainanceEmailID" ).attr("disabled","disabled");
                    }
                    else if(optval=="Both")
                    {
                        $( "#MaintainanceAlertNo" ).removeAttr("disabled");
                        $( "#MaintainanceEmailID" ).removeAttr("disabled");
                    }
                               
                           
                });
              
          
                var url="Jsoncontroller?";
                var query="Operation=getManitationmaserobj&id="+$("#editid").val();
            //    alert(url+query);
                $.ajax({
                    type: "GET",
                    url: url+query,
                    success: function(msg2) 
                    {
                  // alert(msg2);
                    	 var conten="";
                      	var msg = eval(msg2);
                    //  	alert($("#dname").val());
                	$("#devicename").html($("#dname").val());
                	$("#mmid").val(msg[0].mmId);
                	$("#MaintainanceDeviceName").val(msg[0].mmDid);
                	//alert(formattedDate(msg[0].mmDueDate));
                     	$("#reservationtime").val(formattedDate(msg[0].mmStartDate)+" 00:00:00  - "+formattedDate(msg.mmDueDate)+" 23:59:59");
                     	$("#MaintainanceAlertBefore").val(msg[0].mmAlertBefore);
                     	$("#MaintainanceAlertNo").val(msg[0].mmAlertNo);
                    	$("#MaintainanceEmailID").val(msg[0].mmEmail);
                    	$("#MaintainancePeriod").val(msg[0].mmCycle);
                    	$("#Notes").val(msg[0].mmNotes);
                    $("#MaintainanceExpiryTypeid option").filter(function() {
                    	    //may want to use $.trim in here
                    	    return $(this).val() == msg[0].mmExpType; 
                    	}).prop('selected', true); 
                  /*   alert(msg[0].mmExpType);
                    $("#MaintainanceExpiryType option[value='"+msg[0].mmExpType+"']").prop('selected', true); */
                    
                    }
                });	 
          function parseDate(str) {
    var mdy = str.split('-')
    return new Date(mdy[0], mdy[1]-1, mdy[2]);
}

function daydiff(first, second)
{
    return (second-first)/(1000*60*60*24)
}
        </script>
    </body>

</html>
