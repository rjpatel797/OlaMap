
 <script src="js/Report.js"></script>
         <script type="text/javascript">
         function changetype()
         {
             if($("#reprottype").val()=="day")
                 {
              $("#starttime").val("00:00");

                 $("#endtime").val("23:59");

             $("#starttime").hide();
             $("#endtime").hide();
             $("#interval option[value='1440']").attr("selected", "selected");
             //$("#interval").val("1440");
             $("#intv").hide();
                 }
                 else
                     {
                      
              $("#starttime").val("00:00");
     			
                 $("#endtime").val("23:59");

                 $("#starttime").show();
             $("#endtime").show();
             $("#interval option[value='600']").attr("selected", "selected");
             //$("#interval").val("1440");
             $("#intv").show();   
                     }
                 
                 
         }
        </script>
      <section class="content">

      <!-- SELECT2 EXAMPLE -->
      <div class="box box-default" >
        <div class="box-header with-border" style="background-color: #3C8DBC;">

 <h3 class="box-title" style="margin-left: 45%;color: #ffffff;"> <b> Engine Runtime Report</b></h3>
  <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          </div>
           </div>
           <div class="box-body">
 <div class="row">     
        <div class="col-xs-6">
        <label>Date and time range:</label>
                <div class="input-group">
                  <div class="input-group-addon">
                    <i class="fa fa-clock-o"></i>
                  </div>
                  <input type="text" class="form-control pull-right" id="reservationtime">
                </div>
        </div>
          <div class="col-xs-4">
          <label for="deviceId">Device:</label>
          <div id="Getdevice"></div>
          </div>	
          <div class="col-xs-2">
          <label for="interval">Report by	:</label><br/>
                       <select id="reprottype" onchange="changetype();">
                       <option value="time"> Time </option>
                       <option value="day"> Date </option></select> 
          
          </div>
        </div>
         <div class="row" style="margin-top: 4%;margin-left: 50%;">
        <div class="col-xs-3 ">
        <input class="btn btn-success" type="button" name="Submit" value="Submit" onclick="submit()" />
        </div>
        </div>
       </div>
       </div>
        </section>
        <input type="hidden" name="reportname" id="reportname" value="Engine Runtime Report"/>
        <div id="IgnitionReport"></div>
      
<script>

//alert($("#deviceId").val());
var msgcont=new Array();
var pdfstring="";
// var extend="";
//   var extstart="";
var endDateTextBox="";
var startDateTextBox="";

function todays()
{
    submit();

}
  
  function submit()
  {
	  var date=$("#reservationtime").val();
	  if(date=="" || date==null)
		  {
		  alert("Please select Date And Time");
		  }
	  else if($("#deviceId").val()=="" || $("#deviceId").val()==null)
		  {
		  alert("Please select at least one Device Name");
		  }
	  else{
		  
	  var spilt=date.split("-");
	  
	   var dataarray = new Array();
	   var url=API+"Jsoncontroller?Operation=getIgnitionReport";
	  // alert($("#deviceId").val());
	  $.ajax({
              type: "GET",
              url: url,
              dataType: "jsonp",
              data:{deviceId: encodeURIComponent($("#deviceId").val()),fromdate:spilt[0],todate:spilt[1]},
              beforeSend: function(HttpRequest) {
              	$("#IgnitionReport").html('');
              }, success: function(msg2) 
     	     {
              
          //alert(str);
              var msg = eval(msg2);
                
                //alert(msg.length);

            	 
                  //   alert(deviceinfo[0]+"--"+deviceinfo[1]);
                  //   alert(msg2);
                  var conten="";
                  var contcsv="";
                  var total_on=0;
                  var total_off=0;
                  
                  var inittable= '<table id="expiryreport" class="table table-bordered table-striped" style="text-align:center;"><thead style="background-color: #3C8DBC;color: black;text-align:center;"><tr><th><b>Name</b></th><th><b>Start Time</b></th><th><b>End Time</b></th><th><b>On</b></th><th><b>Off</b></th></thead><tbody>';
                  var closetable='</tbody></tr></table>';
                  for(var i=0;i<msg.length;i++)
                  {
                      if(msg[i].time != 0)
                          {
                      conten = conten+ '<tr><td>'+msg[i].dname+'</td><td>'+msg[i].starttime+'</td><td>'+msg[i].endtime+'</td>';
                      if(msg[i].status=="on")
                      {
                         
                          total_on+=parseInt(msg[i].time);
                         
                          conten +='<td style="width:20%;"><font color=green>'+exchangeTime(msg[i].time/1000)+'</font></td><td></td></tr>';
                      }
                      else
                      {
                     
                          total_off +=parseInt(msg[i].time);
                         
                          conten +='<td></td><td style="width:20%;"><font color=red>'+exchangeTime(msg[i].time/1000)+'</font></td></tr>';
                      }
                          }
      
                  }
                  //  alert(conten);
                 /*  $("#csvbtn").html("Start Date,End Date,Distance \n"+contcsv); */
                  $("#IgnitionReport").html(inittable+conten+closetable);
                  initdtforreport();    
                 /*  $("#toolbarbsp").html("Total On Time :<label>"+exchangeTime(total_on/1000)+" </label> & Total Off Time:<label>"+exchangeTime(total_off/1000)+" </label> ");
                  $("#toolbarbsp").addClass("ui-widget-header");
                 
                  $('#btnexp').removeAttr('disabled');
                  $('#btnprt').removeAttr('disabled'); */
           
              // setDeviceProfileParameter();
          }
      });
  }
      }
  
  function exchangeTime(msecond) 
  {
	    
      var dd,hh,mm,ss;
      var strtip = "";
      if(msecond!=0)
      {
          dd = Math.round(msecond / 86400 + 0.5) - 1;
          hh = Math.round((msecond - dd * 86400) / 3600 + 0.5) - 1;
          mm = Math.round((msecond - dd * 86400 - hh * 3600) / 60 + 0.5) - 1;
          ss = Math.round(msecond - dd * 86400 - hh * 3600 - mm * 60);

          if (dd > 0)
              strtip = strtip + dd + " day ";
          if (hh > 0)
              strtip = strtip + hh + " hour ";
          if (mm > 0){
              strtip = strtip + mm + " mins ";
              if(dd > 0)
                  return strtip;
          }
      }
      else
      {
          strtip="0";  
      }
      // if (ss > 0)
      //    strtip = strtip + ss + " secs";
      return strtip;
  }


  function getloc(lat,lang,id)
  {
      historyTracking.gettinylocation(lat,lang,{callback: function(str){                      
                          
              $("#"+id).html(str);
              //alert(str);
          } });
         
  }
  
  function roundNumber(num, dec)
  {
      var result = Math.round(num*Math.pow(10,dec))/Math.pow(10,dec);
      return result;
  }

  function theclock(rightnow)
  {
      //  var rightnow= new Date();
      var month= rightnow.getMonth();var today= rightnow.getDate();var year= rightnow.getYear();var hour= rightnow.getHours();var min= rightnow.getMinutes(); var second= rightnow.getSeconds();
      month+=1;
      if (year<2000)
          year+=1900;
      if (hour<10)
          hour="0"+hour;
      if (min<10)
          min="0"+min;
      if (second<10)
          second="0"+second;
      if (hour<12)
          var ampm="AM";
      else
          var ampm="PM";
      if (hour==0)
          hour=12;
      if (hour>=13)
          hour-=12;
      return today+"/"+month+"/"+year+" "+hour+":"+min+":"+second+" "+ampm;
  }
  
</script>
