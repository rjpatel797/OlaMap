<script type="text/javascript">
var url=API+"Jsoncontroller?";
var query="Operation=getDevicedetailbymid";
//alert(url+query);
$.ajax({
    type: "GET",
    url: url+query,
    dataType: "jsonp",
    beforeSend: function(HttpRequest) {
    //	$("#Getdevice").html(' <img src="images/loading.gif"/>');
    },
    success: function(msg2) 
    {
   // alert(msg2);
    	 var conten="";
      	var msg = eval(msg2);

    	var select= '<select name="deviceId" id="deviceId" class="form-control" data-placeholder="Select a Device">';
        for(var i=0;i<msg.length;i++)
        {
        	conten = conten+' <option value="'+msg[i].DeviceID+'##'+msg[i].Devicename+'##'+msg[i].DeviceProfile+'">'+msg[i].Devicename+'</option>';
        }
        $("#Getdevice").html(select+conten+"</select>");
      //  alert(conten);
    }
});


//Date range picker with time picker
//$('#reservationtime').daterangepicker({timePicker: true, timePickerIncrement: 30, format: 'DD/MM/YYYY HH:mm',timePicker12Hour: false});
$(document).ready(function() {
	var d = new Date(),
    output = [('0' + d.getDate()).substr(-2),
        ('0' + (d.getMonth() + 1)).substr(-2), 
        d.getFullYear()
        
    ].join('/');
	$('#reservationtime').datepicker({format: 'dd/mm/yyyy',maxDate: new Date()
}).val(output);

});

function initdtforreport()
 {/*
var reservationtime=document.getElementById("reservationtime").value;
var date=reservationtime.split("-");
var reportname=document.getElementById("reportname").value;
var from=date[0];
var end=date[1]; */
// alert("sadgsadg");
$("div.tbl-tools-searchbox select").addClass(
 'tbl_length');
$('#expiryreport')
 .dataTable({"scrollX": true});

}
</script>
          <div class="box box-default" >
        <div class="box-header with-border" style="background-color: #3C8DBC;text-align: center;">
<input type="hidden" name="reportname" id="reportname" value="Fleet Summary Report" />
 <h3 class="box-title" style="color:#ffffff;"> <b>Fleet Summary Report</b></h3>
  <div class="box-tools pull-right">
            <button type="button" class="btn-tools" data-widget="collapse"><i class="fa fa-minus"></i></button>
          </div>
           </div>
           <div class="box-body">
 <div class="row">     
        <div class="col-xs-6">
        <label>Date:</label>
                  <input type="text" class="form-control pull-right" id="reservationtime"/>
        </div>
         <div class="col-xs-6">
         <label>Device:</label><br/>
         <div id="Getdevice"></div>
          </div>
        </div>
        <div class="row" style="margin-top: 4%;">
        <div class="col-xs-3 col-xs-offset-3">
        <input class="btn btn-success btn-sm" type="button" name="Submit" value="Submit" onclick="submit()" />
        </div>
        <div class="col-xs-3">
        <input class="btn btn-sm" type="button" name="reset" value="Reset" onclick="reset()" />
        </div>
        </div>
	 </div>
        </div>
        
      <ul class="nav nav-tabs" role="tablist">
   <li role="presentation" class="active"><a href="#Gridview" aria-controls="Gridview" role="tab" data-toggle="tab" onclick="Gridview()">Grid view</a></li>
    <li role="presentation" ><a href="#Listview" aria-controls="Listview" role="tab" data-toggle="tab" onclick="listview()">List view</a></li> 
<!--     <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Graphs</a></li> -->
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
   <div role="tabpanel" class="tab-pane active" id="Gridview" style="margin-top: 5%;">
   <div  id="fleetsummryreportgirdview" style="text-align: center">
  </div>
    <div role="tabpanel" class="tab-pane " id="Listview" ><div  id="fleetsummryreportlistview" style="text-align: center"> </div></div>
   
   <!--  <div role="tabpanel" class="tab-pane" id="Graphsview">...</div> -->
  </div>

</div>
    <script type="text/javascript">
        //alert($("#deviceId").val());
        var msgcont=new Array();
        var pdfstring="";
        var endDateTextBox="";
        var startDateTextBox="";
        function todays()
        {
            submit();
        }
        var msg ="";
        function submit()
        {
            // alert("insubmit");
            var reservationtime= $("#reservationtime").val();
                  //  alert(JSON.stringify(deviceId));
            var startd=reservationtime +" "+"00:00";
            var endd=reservationtime +" "+"23:59";
           // alert(part[0]+" and "+part[1]);
            var device=  encodeURIComponent($("#deviceId").val());
            
            
            if(reservationtime=="" || reservationtime==null)
            {
                alert("Please Select  Date rang");
                        
            }
            else if(device=="" || device==null)
            {
            	alert("Please Select at least one device name");
            }
            else
            	{
               
                    	  var url=API+"Jsoncontroller?Operation=getfleetsummryreport";
                   //alert("device==="+device);
                    $.ajax({
                        type: "GET",
                        url: url,
                        dataType: "jsonp",
                        data:{deviceId:device,fromdate:startd,todate:endd},
                       success: function(msg2) 
               	     {
                        	//  alert(msg2);
                             msg = eval(msg2);
                              
                                var contcsv="";
                                Gridview();
                        
                              
                    }
                    });
                        
                        }
                    
            }

        
        function listview()
        {
        	  var conten="";
        	  $("#fleetsummryreportgirdview").html('');
        	  var inittable= '<table  id="expiryreport" class="table   table-striped" style="border-color:#3C8DBC;" ><thead style="background-color:#3C8DBC; color:white;"><tr><th><b>Device Name</b></th><th><b>Distance Travelled(km)</b></th><th><b>Max. Speed(km/h)</b></th><th><b>Avg. Speed(km/h)</b></th><th><b>Drive Time</b></th><th><b>Stoppage Time</b></th></tr></thead><tbody>';
              var closetable='</tbody></tr></table></div>';
              for(var i=0;i<msg.length;i++)
              {
                  var fuels=roundNumber(parseFloat(msg[i].odometerData)/parseInt(msg[i].milage),2);
                  conten = conten+ '<tr><td>'+msg[i].devicename+'</td><td>'+Math.round(msg[i].odometerData)+'</td><td>'+Math.round(msg[i].MaxSpeed)+'</td><td>'+Math.round(msg[i].AvgSpeed)+'</td><td>'+exchangeTime(msg[i].DriveTime/1000)+'</td><td>'+exchangeTime(msg[i].StoppageTime/1000)+'</td></tr>';
              }
             
              $("#fleetsummryreportlistview").html(inittable+conten+closetable);
              initdtforreport();
        }
        
        
        function Gridview()
        {
        	$("#fleetsummryreportlistview").html('');
         	var divbody="";
      	  var initdiv = '';
      	  var closediv='';
            for (var i = 0; i < msg.length; i++)
            {
          	  divbody += '<div class="box box-success"><div id="box-header with-border"><div class="box-body"><div class="row"><div class="col-xs-6" style="text-align: center;"><h3 style="text-align: center;color:blue;" >'+ msg[i].devicename+'</h3></div><div class="col-xs-6" style="text-align: center;"><h3 style="text-align: center;color:red;">'+ Math.round(msg[i].odometerData)+' Km</h3></div></div><div class="row"><div class="col-xs-4" style="text-align: center;"><label>' +exchangeTime(msg[i].DriveTime/1000).replace(" hour ", ":").replace(" mins", "")+ '</label><br/><label style="color:green;"><img src="androimage/starttime.png"> Running</label></div><div class="col-xs-4" style="text-align: center;"><label>'
                +exchangeTime(msg[i].idealtime/1000).replace(" hour ", ":").replace(" mins", "")+'</label><br/><label style="color:blue;"><img src="androimage/starttime.png"> Idle</label></div><div class="col-xs-4" style="text-align: center;"><label>' +exchangeTime(msg[i].StoppageTime/1000).replace(" hour ", ":").replace(" mins", "")+ '</label><br/><label style="color:red;"><img src="androimage/starttime.png"> Stop</label></div>'
                +'</div><br/><div class="row"><div class="col-xs-4" style="text-align: center;"><label>' +msg[i].AvgSpeed+ '</label><br/><label>Avgrage<h6>(Km/hr)</h6></label></div><div class="col-xs-4" style="text-align: center;"><img src="androimage/spsix.png"><br/><label>Speed</label>'
                +'</div><div class="col-xs-4" style="text-align: center;"><label>' +msg[i].MaxSpeed+ '</label><br/><label>Maximum<h6>(Km/hr)</h6></label></div>'
                +'</div></div></div></div>';
            }
          //  alert(tableheader+tablebody);
          
            $("#fleetsummryreportgirdview").html(initdiv+divbody+closediv);
        }
        function exchangeTime(msecond) {
    
            var dd,hh,mm,ss;
            var strtip = "";
            if(msecond!=0)
            {
                dd = Math.round(msecond / 86400 + 0.5) - 1;
                hh = Math.round((msecond - dd * 86400) / 3600 + 0.5) - 1;
                mm = Math.round((msecond - dd * 86400 - hh * 3600) / 60 + 0.5) - 1;
                ss = Math.round(msecond - dd * 86400 - hh * 3600 - mm * 60);
    
                if (dd > 0)
                    strtip = strtip + dd + "  day ";
                if (hh > 0)
                    strtip = strtip + hh + "  hour ";
                if (mm > 0){
                    strtip = strtip + mm + "  mins ";
                    if(dd > 0)
                        return strtip;
                }
            }
            else
            {
                strtip="0";  
            }
            // if (ss > 0)
            //    strtip = strtip + ss + " secs";
            return strtip;
        }
        
        function roundNumber(num, dec) {
            var result = Math.round(num*Math.pow(10,dec))/Math.pow(10,dec);
            return result;
        }

        function theclock(rightnow){
            //  var rightnow= new Date();
            var month= rightnow.getMonth();var today= rightnow.getDate();var year= rightnow.getYear();var hour= rightnow.getHours();var min= rightnow.getMinutes(); var second= rightnow.getSeconds();
            month+=1;
            if (year<2000)
                year+=1900;
            if (hour<10)
                hour="0"+hour;
            if (min<10)
                min="0"+min;
            if (second<10)
                second="0"+second;
            if (hour<12)
                var ampm="AM";
            else
                var ampm="PM";
            if (hour==0)
                hour=12;
            if (hour>=13)
                hour-=12;
            return today+"/"+month+"/"+year+" "+hour+":"+min+":"+second+" "+ampm;
        }



    </script>

 

</body>
</html>
