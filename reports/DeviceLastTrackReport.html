<!-- <script src="https://maps.googleapis.com/maps/api/js?v=3&libraries=geometry"></script> -->
<script >
var url=API+"Jsoncontroller?Operation=getletesestlocationreport";
//alert("device==="+device);
$.ajax({
    type: "GET",
    url: url,
    dataType: "jsonp",
    beforeSend: function(HttpRequest) {
    //$("#Lasttrackreport").html(' <img src="images/loading.gif"/>');
    }, success: function(msg2) 
    {
    	var table='<table id="expiryreport" class="table table-striped" style="border-color:#3C8DBC;"><thead style="background-color:#3C8DBC; color:white;"><tr><th>Device Name </th><th>Date Time</th><th>Ignition</th> <th>Speed</th><th>AC</th><th>GPS</th><th>Location</th><th>Altitude</th><th>Fuel</th><th>Power</th><th>map</th></tr></thead><tbody>';
		
  	 // alert(msg2);
      var msg = eval(msg2);
      var body="";
      
      for(var i=0;i<msg.length;i++)
      {
    	  var Ignition="";
    	  var AC="";
    	  var power="";
    	  if(msg[i].Ignition==false)
    		  {
    		  Ignition='<img src="mipmap/ing_red.png"/><br/><label style="color:red;">Ignition</label>'
    		  }
    	  else if(msg[i].Ignition==true)
    		{
    			  Ignition='<img src="mipmap/ignition_green.png"/><br/><label style="color:green;">Ignition</label>'
    	    }else
    	    {
        	    Ignition='<img src="mipmap/ignition_gray.png"/><br/><label style="color:black;">Ignition</label>'
            }
    	  
    	  
    	  if(msg[i].AC==false)
		  {
    		  AC='<img src="mipmap/ac_red.png"/><br/><label style="color:red;">AC</label>'
		  }else if(msg[i].AC==true)
		  {
    		  AC='<img src="mipmap/ac_green.png"/><br/><label style="color:green;">AC</label>'
		  }else
			  {
			  AC='<img src="mipmap/ac_gray.png" /><br/><label style="color:black;">AC</label>'
			  }
    	  
    	  
    	  if(msg[i].GPS==false)
		  {
    		  GPS='<img src="mipmap/gps_red.png"/><br/><label style="color:red;">GPS</label>'
		  }if(msg[i].GPS==true)
		  {
    		  GPS='<img src="mipmap/gps_green.png"/><br/><label style="color:green;">GPS</label>'
		  }else
			  {
			  GPS='<img src="mipmap/gps_gray.png"/><br/><label style="color:black;">GPS</label>'
			  }
		  
		  
    	  if(msg[i].power==true)
       	{
       	power='<img src="mipmap/pwr_green.png"/><br/><label style="color:green;">Power</label>';
       	}
           else  if(msg[i].power==false)
       	{
       		power='<img src="mipmap/pwr_red.png"/><br/><label style="color:red;">Power</label>';
       	}    else 
       	{
       		power='<img src="mipmap/pwr_gray.png"/><br/><label style="color:balck;">Power</label>';
       	}       
       	var divbody="";
    	  var initdiv = '';
    	  var closediv='';
          for (var i = 0; i < msg.length; i++)
          {
        	  divbody += '<div class="box box-success"><div id="box-header with-border"><div class="box-body"><div class="row"><div class="col-xs-6" style="text-align: center;"><h3 style="text-align: center;color:blue;" >'+msg[i].devicename+'</h3></div><div class="col-xs-6" style="text-align: center;"><h3 style="text-align: center;color:dark gray;">'+msg[i].datetime+'</h3></div></div><div class="row"><div class="col-xs-2" style="text-align: center;">' +Ignition+ '</div><div class="col-xs-2" style="text-align: center;">'
              +AC+'</div><div class="col-xs-2" style="text-align: center;">' +GPS+ '</div><div class="col-xs-2" style="text-align: center;">' +power+ '</div>'
              +'<div class="col-xs-2" style="text-align: center;"><img src="mipmap/speed.png"><br/><label>'+msg[i].Speed+' Km/h</label></div><div class="col-xs-2" style="text-align: center;"><img src="mipmap/fuel_level.png" /><br/>' +msg[i].Fuel+ '<br/>'
              +'</div></div><div class="row"><div style="text-align: center;"><label>' +msg[i].Location+ '</label></div>'
              +'</div></div></div></div>';
          }
        //  alert(tableheader+tablebody);
        
    	  
    	  //body+='<tr><td>'+msg[i].devicename+'</td><td>'+msg[i].datetime+'</td><td>'+Ignition+'</td><td>'+msg[i].Speed+'</td><td>'+AC+'</td><td>'+GPS+'</td><td>'+msg[i].Location+'</td><td>'+msg[i].Altitude+'</td><td>'+msg[i].Fuel+'</td><td>'+msg[i].Power+'</td><td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#dialog-modal" onclick="openmap('+msg[i].Latitude+','+msg[i].Langitude+','+i+')"> View</button></td></tr>';
      
     }
     $("#Lasttrackreport").html(initdiv+divbody+closediv);
      //$("#Lasttrackreport").html(table+body+"</tbody></table>");
    }
});
    
</script>
    <style type="text/css">
            .datatbl{
                padding:0px;
                margin:0px;  

            }
            .datatbl th{
                background:#BBBBBB;;	
                border-collapse:collapse;
            }
            .datatbl td ,.datatbl th{
                font-family:Tahoma, Geneva, sans-serif;
                font-size:12px;
                color:#252525;
                padding:5px 15px;
                margin:0px;
                border:1px solid #8a8a8a;
                text-align:center;
                line-height:18px;
                border-collapse:collapse;
            }
        </style>
     
<div id="Lasttrackreport"></div>

     


                     <!--  <td><div id="lat${no}"><img src="images/car_icon/images/acc_<%=power%>.gif" /></div></td> 
                
            </tr> -->
<script type="text/javascript">

        var msgcont=new Array();
        var pdfstring="";
        var map="";
        
        function openmap(lat,lang,srno)
            {
        	
        	
        	  map = new google.maps.Map( $("#map")[0], {
                  zoom: 15,
                  //            center:  new google.maps.LatLng( lat,lang ),
                  mapTypeId: google.maps.MapTypeId.ROADMAP
              });
      
              //       $("#map").hide();
      
              //alert();
            //  $(".chzn-select").chosen();
             //  alert("srno."+srno+"lat"+lat+"and"+lang);
      
                map.setCenter( new google.maps.LatLng( lat,lang ));
                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng( lat,lang ),
                    title:"#"+srno
                });

                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({latLng: marker.position}, function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        place = results[0].formatted_address;
                        var ib = new google.maps.InfoWindow({
                            content: place
                        });
        
                        google.maps.event.addListener(marker, "click", function() {
                            ib.open(map, marker);
                        });
      
                
                    }  });
       marker.setMap(map);
             /*    $( "#dialog-modal" ).dialog({
                    height: 600,
                    width:800,
                    modal: true
                });  */
            }
        
        
     
          </script>



 
<div class="modal fade" id="dialog-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
         <div id="map" style="width:550px;height: 600px;"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div> 



   
    </body>
</html>


