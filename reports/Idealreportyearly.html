<script type="text/javascript">
var url=API+"Jsoncontroller?";
var query="Operation=getDevicedetailbymid";
//alert(url+query);
$.ajax({
    type: "GET",
    url: url+query,
    dataType: "jsonp",
    success: function(msg2) 
    {
   // alert(msg2);
    	 var conten="";
      	var msg = eval(msg2);

    	var select= '<select name="deviceId" id="deviceId" class="form-control select2" multiple="multiple" data-placeholder="Select a Device" style="width: 100%;">';
        for(var i=0;i<msg.length;i++)
        {
        	conten = conten+' <option value="'+msg[i].DeviceID+'">'+msg[i].Devicename+'</option>';
        }
        $("#Getdevice").html(select+conten+"</select>");
      //  alert(conten);
        $(".select2").select2({
      	  tags: "true",
      	  placeholder: "Select an option",
      	  allowClear: true
      	});
    }
});


//Date range picker with time picker
$('#reservationtime').daterangepicker({ ranges: {
'Today': [moment(), moment()],
'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
'Last 7 Days': [moment().subtract(6, 'days'), moment()],
'Last 30 Days': [moment().subtract(29, 'days'), moment()],
'This Month': [moment().startOf('month'), moment().endOf('month')],
'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
}, timePicker: true, timePickerIncrement: 30, format: 'DD/MM/YYYY hh:mm '});




function initdtforreport()
{
var reportname=document.getElementById("reportname").value;
// alert("sadgsadg");
$("div.tbl-tools-searchbox select").addClass(
 'tbl_length');
$('#expiryreport')
 .dataTable(
 {
	              
	 "scrollX": true,            
 "sPaginationType" : "full_numbers",
 "oLanguage" : {
 "sLengthMenu" : "<span class='lenghtMenu' > _MENU_</span><span class='lengthLabel'></span>"
 },
 //"sDom" : '<"tbl-tools-searchbox"fl<"clear">>,<"tbl_tools"CT<"clear">>,<"table_content"t>,<"widget-bottom"p<"clear">>',
"sDom": 'T<"clear">lfrtip',


 "oTableTools" : {
 "sSwfPath" : "plugins/datatables/extensions/TableTools/swf/copy_csv_xls_pdf.swf",
"aButtons": [
               "copy",
               "csv",
               "xls",
               {
                   "sExtends": "pdf",
                   "sPdfMessage": "Report Year: "+$("#year").val(),
                  "sTitle" : reportname
               }
           ]
 }
            
 
              
 });

}
    	 
    	 
    		    function getmonthindex(id)
        {
    //alert(id);
            var mon = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUNE', 'JULY', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];



            return mon[id-1]+" 2015";
        }

    		    function daysInMonth(iMonth)
    		    {

    		    	var mn=iMonth.split("-");
    		    	return iMonth+"-"+(33 - new Date(mn[0], mn[1]-1, 32).getDate());
    		    }

    		    function submit()
                {
    		    	
    		    	document.getElementById("error").innerText = ' '


    		    	  //alert("hiiii"); 	  
    		    var deviceid=document.getElementById("deviceId").value;
    		    if(deviceid=="")
    		    	{
    		    	document.getElementById("error").innerText = 'plese enter device id'
    		    	}
    		    else
    		    {

                  var url=API+"Jsoncontroller?";
                var query="Operation=getyearlyidealreport&did="+$("#deviceId").val()+"&year="+$("#year").val();
     
                $.ajax({
                    type: "GET",
                    url: url+query,
                    dataType: "jsonp",
                    success: function(msg2) {
                    	
                    //	alert(msg2);
                    	
                    	
                    	  var html2="";
                          var html3="";
                          var html1="";
                          var htmlwname="";
                           var html = "";
                                   // var pa = "";
                                    var present=0;
                                    var ary="";
                                    json=eval(msg2);
                                    
                              //   alert(json.length);
                                    var isfrs=false;
                                    for(var k=0;k<json.length;k++)
                                        {
                                          var sname=json[k][0].sname;

                                            html3+="<tr><td>"+sname+"</td>";
                                           // html2+="<th>studame</th>";
                                          var present=0;
                                          var working=0
                                          var ma=0;
                			$.each(json[k],function(i,ary){

                                           //  alert(ary.length);
                                           if(k==0)
                                               {

                                           html2+="<th>"+ary.Months+"</th>";

                                               }
                                          
                                           var pa;
                                           if(parseInt(ary.totalminute) == 0)
                      					 {
                                        	    pa = "0:0:0";
                      					 }
                      					 else
                      					 {
                      						 pa = exchangeTime(parseInt(ary.totalminute)*60);  
                      					 }
                                     		
                                     
                                     
                					 if(ary.totalminute == "-")
                					 {
                					 pa="-";
                					 }
                					 else
                					 {
                						 ma+=parseInt(ary.totalminute);  
                					 }
                         
                        html3+="<td>"+pa+"</td>";
                        working++;
                                       
                        		   

                			});
                                        html3+="<td>"+exchangeTime(ma*60)+"</td></tr>";
                                        }

                                 //   var mnth=$("#monthsel").val().split("-");
                                 var year=0;
                                 year=$("#yearpicker").val();
                                 var y=year++;

                                    var html4='<table id="expiryreport" class="table table-striped" style="border-color:#3C8DBC;"><thead><tr><th>Device Name</th>'+html2+'<th>Total(DD:MM:HH)</th></tr></thead><tbody>'+html3;
                                    
                                    //var html4='<table id="distancereport" class="table table-condensed table-nomargin table-bordered dataTable table-hover dataTable-tools"><thead><tr><th></th><th colspan=31>Month :APR Total Working Days:25</th><th></th></tr><tr><th rowspan=2>Name</th>'+html2+'<th></th></tr></thead><tbody>'+html3;


                                    $("#idelReportbyyearlly").html(html4 + "</tbody></table>");

                                    $("#expng").show();

                                    //     $("#charts").html(chartsd);
                                  initdtforreport();
                             
                    }
                });
                
              

                }
                }
    		    
    		    


</script>
   <section class="content"> 
          <div class="box box-default" >
        <div class="box-header with-border" style="background-color: #3C8DBC;">
<input type="hidden" name="reportname" id="reportname" value="Idle Report By Datewise" />
 <h3 class="box-title" style="margin-left: 45%;color: #ffffff;"> <b> Idle  Yearlly Report</b></h3>
  <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          </div>
           </div>
           <div class="box-body">
 <div class="row">     
        <div class="col-xs-6">
        <label>Year:</label>
             <div class="input-group">
                  <div class="input-group-addon">
                    <i class="fa fa-clock-o"></i>
                  </div>
                  <input type="text" class="form-control pull-right" id="year">
                </div>
        </div>
         <div class="col-xs-6">
         <label for="deviceId">Device:</label><br/>
            <div id="Getdevice"></div>  
          </div>
        </div>
        <div class="row" style="margin-top: 4%;margin-left: 45%;">
        <div class="col-xs-3 ">
        <input class="btn btn-success" type="button" name="Submit" value="Submit" onclick="submit()" />
        </div>
        </div>
	 </div>
        </div>
     
        </section> 
     <div id="error"></div>
    <script type="text/javascript">
    
    $("#year").datepicker( {
        format: "yyyy",
        viewMode: "years", 
        minViewMode: "years"
    });
    
        //alert($("#deviceId").val());
        var msgcont=new Array();
        var pdfstring="";
        // var extend="";
        //   var extstart="";
        var endDateTextBox="";
        var startDateTextBox="";

        function todays()
        {
  
            // var date = new Date();
            //  var d  = date.getDate();
            //  var day = (d < 10) ? '0' + d : d;
            // var m = date.getMonth() ;
            //  var month = (m < 10) ? '0' + m : m;
            // var yy = date.getYear();
            //  var year = (yy < 1000) ? yy + 1900 : yy;
   
         
            // startDateTextBox.datepicker('setDate', new Date() );
            submit();

        }
        function reset()
        {
            $("#startdate").val("");
            $("#enddate").val("");
            $("#interval").val("");
        }
        
                function exchangeTime(msecond) {
    
            var dd,hh,mm,ss;
            var strtip = "";
            if(msecond!=0)
            {
                dd = Math.round(msecond / 86400 + 0.5) - 1;
                hh = Math.round((msecond - dd * 86400) / 3600 + 0.5) - 1;
                mm = Math.round((msecond - dd * 86400 - hh * 3600) / 60 + 0.5) - 1;
                ss = Math.round(msecond - dd * 86400 - hh * 3600 - mm * 60);
    
               
                    strtip = strtip + dd +":"+hh+":"+mm+"";
                    
                        return strtip;
              
            }
            else
            {
                strtip="0";  
            }
            // if (ss > 0)
            //    strtip = strtip + ss + " secs";
            return strtip;
        } 
                function exchangeTime1(seconds) {
                    var strtip = "";
                    if(seconds!=0)
                    {
                    	var nummonths= Math.floor((seconds % 31536000) / 2628000);
                    	var numdays = Math.floor(((seconds % 31536000) % 2628000) / 86400);
                    	var numhours = Math.floor((((seconds % 31536000) % 2628000) % 86400)/3600);
                    	var numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);
            
                       
                            strtip = strtip+nummonths+":"+numdays+":"+numhours+":"+numminutes+"";
                            
                                return strtip;
                      
                    }
                    else
                    {
                        strtip="0";  
                    }
                    // if (ss > 0)
                    //    strtip = strtip + ss + " secs";
                    return strtip;
                } 


        
        function roundNumber(num, dec) {
            var result = Math.round(num*Math.pow(10,dec))/Math.pow(10,dec);
            return result;
        }

        function theclock(rightnow){
            //  var rightnow= new Date();
            var month= rightnow.getMonth();var today= rightnow.getDate();var year= rightnow.getYear();var hour= rightnow.getHours();var min= rightnow.getMinutes(); var second= rightnow.getSeconds();
            month+=1;
            if (year<2000)
                year+=1900;
            if (hour<10)
                hour="0"+hour;
            if (min<10)
                min="0"+min;
            if (second<10)
                second="0"+second;
            if (hour<12)
                var ampm="AM";
            else
                var ampm="PM";
            if (hour==0)
                hour=12;
            if (hour>=13)
                hour-=12;
            return today+"/"+month+"/"+year+" "+hour+":"+min+":"+second+" "+ampm;
        }



    </script>

    <div  id="idelReportbyyearlly" align="center" style="text-align: center">

    </div>

</body>
</html>
