 <script src="js/Report.js"></script>
        <script type="text/javascript">
    
    function getpoiname(lat,lang,id)
            {
                Dashboard.getpoiname('<%=session.getAttribute("mid")%>',lat,lang,function(msg)
                {
                    $("#"+id).html(msg);
                });
            } 
          
        </script>
    </head>

<section class="content"> 
          <div class="box box-default" >
        <div class="box-header with-border" style="background-color: #3C8DBC;">

 <h3 class="box-title" style="margin-left: 45%;color: #ffffff;"> <b> Trip Report</b></h3>
  <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          </div>
           </div>
           <div class="box-body">
 <div class="row">     
        <div class="col-xs-6">
        <label>Date and time range:</label>
             <div class="input-group">
                  <div class="input-group-addon">
                    <i class="fa fa-clock-o"></i>
                  </div>
                  <input type="text" class="form-control pull-right" id="reservationtime">
                </div>
        </div>
         <div class="col-xs-4">
         <label for="deviceId">Device:</label><br/>
         <div id="Getdevice"></div>  
          </div>
          <div class="col-xs-2">
         <label for="interval">Minimum Trip Time:</label>
                        <select name="interval" id="interval">
                            <option value="300000" >5 Min</option>
                            <option value="900000" >15 Min</option>
                            <option value="1800000">30 Min</option>
                            <option value="3600000" selected>1 Hour</option>
                            <option value="7200000">2 Hour</option>
                            <option value="18000000">5 Hour</option>
                            <option value="36000000">10 Hour</option>
                        </select>
          </div>
          <div class="col-xs-2">
          <input type="hidden" id="reportname" value="Trip Report" /> 
          <input type="radio"  id="poicheck" name="poicheck"  />Location By POI<br/>
          <input type="radio"  id="poicheck1" name="poicheck" />Address
          </div>
        </div>  
        <div class="row" style="margin-top: 4%;margin-left: 45%;">
        <div class="col-xs-3 ">
        <input class="btn btn-success" type="button" name="Submit" value="Submit" onclick="submit()" />
        </div>
        </div>    
            </div>
            </div>
            </section>
        <script type="text/javascript">
            //alert($("#deviceId").val());
            var msgcont=new Array();
            var pdfstring="";
            // var extend="";
            //   var extstart="";
            var endDateTextBox="";
            var startDateTextBox="";

           function reset()
            {
                $("#startdate").val("");
                $("#enddate").val("");
                $("#interval").val("");
            }
            function submit()
            {
                // alert("insubmit");
               var reservationtime= $("#reservationtime").val();
                  var part=reservationtime.split("-");
                  //  alert(JSON.stringify(deviceId));
		            var startd=part[0];
		            var endd=part[1];
           // alert(part[0]+" and "+part[1]);
                var device = $("#deviceId").val();
               
                var mid=  $("#Mid").val();
                var minstop=$("#interval").val();
                if(device=="" || device==null)
                {
                    alert("Please Select Device");
                }
                else if(reservationtime=="" || reservationtime==null)
                {
                    alert("Please Select Date range");
                        
                }
              
                else{
                	var poi=document.getElementById('poicheck').checked;
                 //  alert(poi);
                    var isChecked =false; 
                    //  $("#ajaxloader").html("Please wait..<img src='../images/ajax-loader-bar.gif'/>");
                    if(poi)
                    	{
                    	isChecked=true;
                    	}
                    var url=API+"Jsoncontroller?";
                    var query="Operation=gettripreport&did="+device.toString()+"&startd="+startd+"&endd="+endd+"&minstop="+minstop+"&isChecked="+isChecked;
         
                    $.ajax({
                        type: "GET",
                        url: url+query,
                        dataType: "jsonp",
                        success: function(msg2) {
                        	// alert(msg2);
                        	   var msg = eval(msg2);
                          
                                  
                                   var conten="";
                                   var contcsv="";
                                   //        alert(msgcont[0]);
                                   //alert(msgcont.length);
                                   //     alert(deviceinfo[1]);
                                   var inittable= '<br/><table id="expiryreport" class="table   table-striped" style="border-color:#3C8DBC;" ><thead style="background-color:#3C8DBC; color:white;"><tr><th>Srno</th><th><b>Device Name</b></th><th><b>Start Date</b></th><th><b>End Date</b></th><th><b>Start Location</b></th><th><b>End Location</b></th><th><b>Total KM</b></th><th><b>Total Time</b></th><th><b>Fuel Consumption</b></th></tr></thead><tbody>';
                                   var closetable='</tbody></tr></table>';
                                   for(var i=0;i<msg.length;i++)
                                   {
                                     /*   if(msg[i].odometer > 0)
                                       {
                                           if(msg[i].frmloc !=0)
                                          { */
                                          
                                   
           var fuels=roundNumber(parseFloat(msg[i].odometer)/parseInt(msg[i].milage),2);
           conten = conten+ '<tr><td>'+(i+1)+'</td><td>'+msg[i].dname+'</td><td style="width:10%;">'+msg[i].frmdate+'</td><td style="width:10%;">'+msg[i].todate+'</td><td style="width:20%;" id="start'+i+'">'+msg[i].frmloc+'</td><td style="width:20%;"  id="end'+i+'">'+msg[i].toloc+'</td><td>'+Math.round(msg[i].odometer)+'</td><td>'+exchangeTime(msg[i].hold/1000)+'</td><td>'+fuels+'</td></tr>';
                                           }
                                        /* }
                                   } */
                                   //   alert(contcsv);
                                   $("#csvbtn").html("Start Date,End Date,Distance \n"+contcsv);
                                   $("#Tripreport").html(inittable+conten+closetable);
                                   initdtforreport();
                                   $('#btnexp').removeAttr('disabled');
                                   $('#btnprt').removeAttr('disabled');
                                   $('#btnshowchart').removeAttr('disabled');

                                   // drowchart();
                               }
                
                    });
                    
                         
                      
                }
                
            }
            function exchangeTime(msecond) {
                var dd,hh,mm,ss;
                dd = Math.round(msecond / 86400 + 0.5) - 1;
                hh = Math.round((msecond - dd * 86400) / 3600 + 0.5) - 1;
                mm = Math.round((msecond - dd * 86400 - hh * 3600) / 60 + 0.5) - 1;
                ss = Math.round(msecond - dd * 86400 - hh * 3600 - mm * 60);
                var strtip = "";
                if (dd > 0)
                    strtip = strtip + dd + " day ";
                if (hh > 0)
                    strtip = strtip + hh + " hour ";
                if (mm > 0){
                    strtip = strtip + mm + " mins ";
                    if(dd > 0)
                        return strtip;
                }
                // if (ss > 0)
                //    strtip = strtip + ss + " secs";
                return strtip;
            }


            function getloc(lat,lang,id)
            {
                historyTracking.gettinylocation(lat,lang,{callback: function(str){   $("#"+id).html(str);  } });
            }
         function roundNumber(num, dec) {
                var result = Math.round(num*Math.pow(10,dec))/Math.pow(10,dec);
                return result;
            }
      function theclock(rightnow){
                //  var rightnow= new Date();
                var month= rightnow.getMonth();var today= rightnow.getDate();var year= rightnow.getYear();var hour= rightnow.getHours();var min= rightnow.getMinutes(); var second= rightnow.getSeconds();
                month+=1;
                if (year<2000)
                    year+=1900;
                if (hour<10)
                    hour="0"+hour;
                if (min<10)
                    min="0"+min;
                if (second<10)
                    second="0"+second;
                if (hour<12)
                    var ampm="AM";
                else
                    var ampm="PM";
                if (hour==0)
                    hour=12;
                if (hour>=13)
                    hour-=12;
                return today+"/"+month+"/"+year+" "+hour+":"+min+":"+second+" "+ampm;
            }
        </script>
        <div  id="Tripreport" align="center" style="text-align: center">  </div>
        <script type='text/javascript' src='./dwr/interface/historyTracking.js'></script>
        <script type='text/javascript' src='./dwr/interface/Dashboard.js'></script>
       
