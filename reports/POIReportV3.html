<script type="text/javascript">
var url=API+"Jsoncontroller?";
var query="Operation=getDevicedetailbymid";
//alert(url+query);
$.ajax({
    type: "GET",
    url: url+query,
    dataType: "jsonp",
    success: function(msg2) 
    {
   // alert(msg2);
    	 var conten="";
      	var msg = eval(msg2);

    	var select= '<select name="deviceId" id="deviceId" class="form-control select2" data-placeholder="Select a Device" style="width: 100%;">';
        for(var i=0;i<msg.length;i++)
        {
        	conten = conten+' <option value="'+msg[i].DeviceID+'">'+msg[i].Devicename+'</option>';
        }
        $("#Getdevice").html(select+conten+'</select>');
      //  alert(conten);
        $(".select2").select2({
      	  tags: "true",
      	  placeholder: "Select an option",
      	  allowClear: true
      	});
    }
});

var url=API+"Jsoncontroller?";
var query="Operation=getPoipoint";
//alert(url+query);
$.ajax({
    type: "GET",
    url: url+query,
    dataType: "jsonp",
    success: function(msg2) 
    {
   // alert(msg2);
    	 var conten="";
      	var msg = eval(msg2);

    	var select= '<select name="poilocation" id="poilocation" class="form-control"  style="width: 100%;">';
        for(var i=0;i<msg.length;i++)
        {
        	conten = conten+' <option value="'+msg[i].no+'">'+msg[i].Location+'</option>';
        }
        $("#getPoipoint").html(select+'<option value="all">ALL</option>'+conten+'</select>');
    }
});

//Date range picker with time picker
$('#reservationtime').daterangepicker({timePicker: true, timePickerIncrement: 30, format: 'DD/MM/YYYY HH:mm',timePicker12Hour: false});




function initdtforreport()
{
var reservationtime=document.getElementById("reservationtime").value;
var date=reservationtime.split("-");
var reportname=document.getElementById("reportname").value;
var from=date[0];
var end=date[1];
// alert("sadgsadg");
$("div.tbl-tools-searchbox select").addClass(
 'tbl_length');
$('#expiryreport')
 .dataTable(
 {
	              
	 "scrollX": true,            
 "sPaginationType" : "full_numbers",
 "oLanguage" : {
 "sLengthMenu" : "<span class='lenghtMenu' > _MENU_</span><span class='lengthLabel'></span>"
 },
 //"sDom" : '<"tbl-tools-searchbox"fl<"clear">>,<"tbl_tools"CT<"clear">>,<"table_content"t>,<"widget-bottom"p<"clear">>',
"sDom": 'T<"clear">lfrtip',


 "oTableTools" : {
 "sSwfPath" : "plugins/datatables/extensions/TableTools/swf/copy_csv_xls_pdf.swf",
"aButtons": [
               "copy",
               "csv",
               "xls",
               {
                   "sExtends": "pdf",
                   "sPdfMessage": "Report From:  "+from+" Report To:  "+end,
                  "sTitle" : reportname
               }
           ]
 }
            
 
              
 });

}
var msg ="";
		 function submit()
	        {
	            // alert("insubmit");
	  		var reservationtime= $("#reservationtime").val();
            var part=reservationtime.split("-");
                  //  alert(JSON.stringify(deviceId));
            var startd=part[0];
            var endd=part[1];
          //  alert(part[0]+" and "+part[1]);
            var deviceid=  $("#deviceId").val().toString();
	            // var device=$("#deviceId").val().toString();
	
	            var distance = $("#distance").val();
	           // var deviceid = $("#deviceid").val();
	            var plocation = $("#poilocation").val();
	            var time=$("#time").val();
	            //alert("time is..."+time);
	            var tempdate = new Date();
	            var tempdate2 = "";
	         
	            if (reservationtime == "" || reservationtime == null)
	            {
	                alert("Please Select Date");
	
	            }
	
	            else if (deviceid == "" || deviceid == null)
	            {
	                alert("Please Select at least one Device");
	
	            }
	            else 
	            {
	            	var url=API+"Jsoncontroller?";
	            	var query="Operation=getPoireport&did="+deviceid+"&sdate="+startd+"&edate="+endd+"&poiname="+plocation+"&distance="+time;
	                $.ajax({
  					 type: "GET",
    				 url: url+query,
    				 dataType: "jsonp",
  					 success: function(msg2) 
   					 {
  						//alert("Data is..."+msg2);
	                         msg = eval(msg2);
	                         Gridview();
	                      
   					 }
	                });
	            }
	
	        }
		 function listview()
	        {
			 
			 
	        	  var conten="";
	        	  $("#fleetsummryreportgirdview").html('');
	        	  var conten = "";
                  var totalhold = 0;
                  var inittable = '<br/><table  id="expiryreport" class="table table-striped" style="border-color:#3C8DBC;"><thead style="background-color:#3C8DBC; color:white;"><tr><th><b>No</b></th><th><b>Entry Date</b></th><th><b>Exit date</b></th><th><b>POI Location</b></th><th><b>Hold Time</b></th></tr><thead><tbody>';
                  var closetable = '</tbody></table>';
                  var count=1;
	             
	              
	              
	              //      alert(msg[0].startTime);  
	          	
                  //    alert(moment(msg[0].startTime, "YYYY-MM-DD HH:mm:ss"));
                 
                  for (var i = 0; i < msg.length; i++)
                  {
//                                //totalhold+=msg[i].hold;                                
                        //  alert(i +"  "+msg.length);  
//                          
//                          alert(moment(msg[i].startTime, "YYYY-MM-DD HH:mm:ss"));
                      if (typeof(msg[i].startTime) != "undefined")
                      {
                          tempdate = moment(msg[i].startTime, "YYYY-MM-DD HH:mm:ss");

                          tempdate2 = msg[i].startTime;


                          //conten +='<tr><td>'+msg[i].startTime+'</td><td>N/A</td><td>'+msg[i].location+'</td><td></td></tr>';   

                      } else
                      {
                          var totalholdtime = getTimeDiff(msg[i].endTime.toString(), tempdate2.toString());
                         // alert(totalholdtime);
							var holdtime = exchangeTime(totalholdtime);
								//if(totalholdtime>300)
								//{
									
                          //        var endtm=getTimeDiff(moment(msg[i].endTime, "YYYY-MM-DD HH:mm:ss")-tempdate);
                          conten += '<tr><td>'+count+'</td><td>' + tempdate2 + '</td><td>' + msg[i].endTime + '</td><td>' + msg[i].location + '</td><td>' + holdtime + '</td></tr>';
                          count++;
								//}
                          //     conten +='<tr><td>N/A</td><td>'+msg[i].endTime+'</td><td>'+msg[i].location+'</td><td>'+exchangeTime(endtm)+'</td></tr>';                                
                      }

                      //           conten +='<tr><td>'+msg[i].dname+'</td><td>'+msg[i].ddscr+'</td><td>'+startd+'</td><td>'+endd+'</td><td id="start'+i+'">'+msg[i].location+'</td><td>'+exchangeTime(msg[i].totalhold/1000)+'</td></tr>';
                  }
                  $("#fleetsummryreportlistview").html(inittable+conten+closetable);
	              initdtforreport();
	              
	        }
	        
	        
		 function Gridview()
		  {
		  	$("#fleetsummryreportlistview").html('');
		   	var divbody="";
			  var initdiv = '';
			  var closediv='';
		      for (var i = 0; i < msg.length; i++)
		      {
		    	  var tempdate="";
		    	  var tempdate2="";
		    	  if (typeof(msg[i].startTime) != "undefined")
                  {
                      tempdate = moment(msg[i].startTime, "YYYY-MM-DD HH:mm:ss");

                      tempdate2 = msg[i].startTime;


                      //conten +='<tr><td>'+msg[i].startTime+'</td><td>N/A</td><td>'+msg[i].location+'</td><td></td></tr>';   

                  } else
                  {
                      var totalholdtime = getTimeDiff(msg[i].endTime.toString(), tempdate2.toString());
                     // alert(totalholdtime);
						var holdtime = exchangeTime(totalholdtime);
                  // alert(totalholdtime);
						var holdtime = exchangeTime(totalholdtime);
		    	  divbody += '<div class="box box-success"><div id="box-header with-border"><div class="box-body"><div class="row"><div class="col-xs-4" style="text-align: center;"><label>'+ tempdate2+'</label><br/><img src="androimage/starttime.png"> <label> Start Time</label></div><div class="col-xs-4" style="text-align: center;">'+ holdtime+'</label><br/><label>Duration</label></div><div class="col-xs-4" style="text-align: center;"><label style="text-align: center;">'
		    	  + msg[i].endTime+'<br/><img src="androimage/endtime.png"> <label> End Time</label></label></div></div><br/>'
		          +'<div class="row"><div class="col-xs-12" style="text-align: center;"><h2><label>' +msg[i].location+ '</label></h2></div>'
		          +'</div></div></div></div>';
                  }
		      }
		    //  alert(tableheader+tablebody);
		    
		      $("#fleetsummryreportgirdview").html(initdiv+divbody+closediv);
		  }
	    </script>
	
	        <div align="center">
	<section class="content"> 
          <div class="box box-default" >
        <div class="box-header with-border" style="background-color: #3C8DBC;">
 <h3 class="box-title" style="color: #ffffff;"> <b>POI History Report</b></h3>
  <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
          </div>
           </div>
           <div class="box-body">
 <div class="row">     
        <div class="col-xs-6">
        <label>Date and time range:</label>
             <div class="input-group">
                  <div class="input-group-addon">
                    <i class="fa fa-clock-o"></i>
                  </div>
                  <input type="text" class="form-control pull-right" id="reservationtime">
                </div>
        </div>
         <div class="col-xs-3">
         <label for="deviceId">Device:</label><br/>
         <div id="Getdevice"></div>
          </div>
          <div class="col-xs-3">
          <label for="distance">Distance(<b>Meters</b>):</label> <br/> <input type="text" class="form-control" name="distance" id="distance" value="250" >
          </div>
          
        </div>
        <div class="row" style="margin-top: 4%;">
        <div class="col-xs-4">
	<label for="Duration">Duration(<b>Minutes</b>):</label> <br/> <input type="text" class="form-control" name="time" id="time" value="10" >
	</div>
        	<div class="col-xs-4">
          <label for="poilocation" >POI:</label> <div id="getPoipoint"></div>
	       </div>
        <div class="col-xs-4">
        <label> </label><br/>
        <input class="btn btn-success" type="button" name="Submit" value="Submit" onclick="submit()" />
        </div>
        </div>
	

	 </div>
        </div>
     
        </section>
	
	            <input name="reportname" id="reportname" type="hidden" value="POI Report">
	        </div>
      <ul class="nav nav-tabs" role="tablist">
   <li role="presentation" class="active"><a href="#Gridview" aria-controls="Gridview" role="tab" data-toggle="tab" onclick="Gridview()">Grid view</a></li>
    <li role="presentation" ><a href="#Listview" aria-controls="Listview" role="tab" data-toggle="tab" onclick="listview()">List view</a></li> 
<!--     <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Graphs</a></li> -->
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
   <div role="tabpanel" class="tab-pane active" id="Gridview" style="margin-top: 1%;">
   <div  id="fleetsummryreportgirdview" style="text-align: center">
  </div>
    <div role="tabpanel" class="tab-pane " id="Listview" ><div  id="fleetsummryreportlistview" style="text-align: center"> </div></div>
   
   <!--  <div role="tabpanel" class="tab-pane" id="Graphsview">...</div> -->
  </div>

</div>
  <script type="text/javascript" src="js/jsutils.js"></script>